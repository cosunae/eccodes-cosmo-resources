#local section DWD

#weil in section.4.def benutzt und diese ist wegen ieeefloat Fehler local
constant productDefinitionTemplateNumberInternal=0 : hidden,no_copy;

#DL as this definition file is used by different centres per link define aliases
# according to centreForLocal
if (centreForLocal != 78) {
alias localDefinitionNumber=grib2LocalSectionNumber;
} else {
alias grib2LocalSectionNumber=localDefinitionNumber;
}

#if (section2Length==20) {
# if (section2Length==20 && tiggeSuiteID == 255) {
 if (section2Length==20 && !(defined(suiteName))) {
#  unsigned[1] localDefinitionNumber: dump;
  unsigned[1] localHostIdentifier: dump;
  unsigned[2] localCreationDateYear: dump;
  unsigned[1] localCreationDateMonth: dump;
  unsigned[1] localCreationDateDay: dump;
  unsigned[1] localCreationDateHour: dump;
  unsigned[1] localCreationDateMinute: dump;
  unsigned[1] localCreationDateSecond: dump;
  unsigned[2] localInformationNumber: dump;
  unsigned[2] localVersionNumber: dump;
  unsigned[2] reserved;

  meta localDecodeDateL evaluate(localCreationDateYear*10000000000 + localCreationDateMonth*100000000 + localCreationDateDay*1000000 + localCreationDateHour*10000 + localCreationDateMinute*100 + localCreationDateSecond);
  meta localDecodeDate sprintf("%d",localDecodeDateL): no_copy, dump;

 } else {

   if ( (localDefinitionNumber == 252 ) || (localDefinitionNumber == 253 )
      || (localDefinitionNumber == 28 )
      || (localDefinitionNumber == 250 ) || (localDefinitionNumber == 254 ) 
      || (localDefinitionNumber == 123 ) || (localDefinitionNumber == 124 ) 
      || (localDefinitionNumber == 125 ) ){
      template  localSection  "grib2/local.78.[localDefinitionNumber:l].def";
   } else {
      section_padding section2Padding : read_only;
#      meta localDecodeDate sprintf("%d",localDecodeDateL): no_copy, dump;
#      meta localValidityDate sprintf("%d",localValidityDateL): dump;
   }
}

if (centreForLocal == 215) {
 # class
 # transient marsClass='od';

## typeOfGeneratingProcess
# COSMO-1E, COSMO-2E: 4 = Ensemble forecast
# KENDA-1 det: 0 = Analysis
# KENDA-1 det (XXXXhcem, XXXXtthrs, XXXXtthre, XXXXfr; XXXX=pollen species): 9 = Climatological
# KENDA-1 ens: 0 = Analysis
# KENDA-1 mean (laf): 0 = Analysis
# KENDA-1 spread (laf): 0 = Analysis
# KENDA-1 First Guess det: 2 = Forecast
# KENDA-1 First Guess ens: 4 = Ensemble forecast
# SNOWPOLINO: 0 = Analysis
# ICON-CH1-EPS, ICON-CH2-EPS: 4 = Ensemble forecast

## generatingProcessIdentifier
# COSMO-1E: 121
# COSMO-2E: 122
# KENDA-1 det: 121
# KENDA-1 det (XXXXhcem, XXXXtthrs, XXXXtthre, XXXXfr; XXXX=pollen species): 121
# KENDA-1 ensemble: 121
# KENDA-1 First Guess det: 121
# KENDA-1 First Guess ens: 121
# SNOWPOLINO: 121
# ICON-CH1-EPS: 141 
# ICON-CH2-EPS: 142

##ï¿½backgroundProcess
# COSMO-1E: 0=main run
# COSMO-2E: 0=main run
# ICON-CH1-EPS: 0=main run
# ICON-CH2-EPS: 0=main run
# KENDA-1 det: 2=assimilation
# KENDA-1 det (XXXXhcem, XXXXtthrs, XXXXtthre, XXXXfr; XXXX=pollen species): 0=main run
# KENDA-1 ensemble: 2=assimilation
# KENDA-1 First Guess det: 0=main run
# KENDA-1 First Guess ens: 0=main run
# SNOWPOLINO: 0=main run

# ATTENTION: KENDA-1 is not fully supported; the coding of KENDA-CH1 needs to be revised, before
#            it can be fully supported  

# class
# ... operational data
constant marsClass='od';

concept marsStream(unknown) {
    # Ensemble data assimilation system
    # ... uninitialized analysis
    enda = {
      typeOfGeneratingProcess = 0;
      backgroundProcess = 2;}
    # ... analysis increment (to be defined)
    # ... initialized analysis (to be defined)
    # ... first guess det (to be defined)
    # ensemble forecast
    enfo = {
      typeOfGeneratingProcess = 4;}
} : no_copy;

concept marsType(unknown) {
    # deterministic forecast or assimilation product
    # # (a new type could be used for each productDefinitionTemplateNumber)
    # ... instantaneous value
    det = {
      productDefinitionTemplateNumber = 0;}
    # ... instantaneous value, chemical constituent
    det = {
      productDefinitionTemplateNumber = 40;}
    # ... temporal accumulation
    det = {
      productDefinitionTemplateNumber = 8;}
    # ... temporal accumulation, chemical constituent
    #     COSMO and ICON define a unique parameter id for each combination of 
    #     (discipline, parameterCategory, parameterNumber), and chemical constituent
    det = {
      productDefinitionTemplateNumber = 42;}
    # ensemble forecast or assimilation product, perturbed or control member 
    # (a new type could be used for each productDefinitionTemplateNumber)
    # ... instantaneous value
    ememb = {
      productDefinitionTemplateNumber = 1;}
    # ... instantaneous value, chemical constituent
    ememb = {
      productDefinitionTemplateNumber = 41;}
    # ... temporal accumulation
    ememb = {
      productDefinitionTemplateNumber = 11;}
    # ... temporal accumulation, chemical constituent
    ememb = {
      productDefinitionTemplateNumber = 43;}
    # derived forecast
    # ... instantaneous value, unweighted ensemble mean
    emean = {
      productDefinitionTemplateNumber = 2;
      derivedForecast = 0;}
    # ... instantaneous value, unweighted ensemble standard deviation
    estdv = {
      productDefinitionTemplateNumber = 2;
      derivedForecast = 4;}
} : no_copy;

concept marsModel(unknown) {
    'COSMO-1E' = {
      generatingProcessIdentifier = 121;
      typeOfGeneratingProcess = 4;
      backgroundProcess = 0;}
    'COSMO-2E' = {
      generatingProcessIdentifier = 122;
      typeOfGeneratingProcess = 4;
      backgroundProcess = 0;}
    'KENDA-1' = {
      generatingProcessIdentifier = 121;
      typeOfGeneratingProcess = 0;
      backgroundProcess = 2;}
    'KENDA-1' = {
      generatingProcessIdentifier = 121;
      typeOfGeneratingProcess = 2;
      backgroundProcess = 0;}
    'KENDA-1' = {
      generatingProcessIdentifier = 121;
      typeOfGeneratingProcess = 9;
      backgroundProcess = 0;}
    'SNOWPOLINO' = {
      generatingProcessIdentifier = 121;
      typeOfGeneratingProcess = 0;
      backgroundProcess = 0;}
    'ICON-CH1-EPS' = {
      generatingProcessIdentifier = 141;}
    'ICON-CH2-EPS' = {
      generatingProcessIdentifier = 142;}
    'KENDA-CH1' = {
      generatingProcessIdentifier = 151;}
} : no_copy;

 constant marsExpver = '0001';

 alias mars.class = marsClass;
 alias mars.stream = marsStream;
 alias mars.type = marsType;
 alias mars.model = marsModel;
 alias mars.expver = marsExpver;
}
